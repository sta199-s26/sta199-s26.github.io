---
title: Lab 3
subtitle: A pivot and a join walk into a pipe...
description: "Due: End of lab on Mon, Sep 22"
categories: Lab
filters:
  - ../remove-fmt-skip.lua
draft: true
---

# Introduction

In this lab you'll get to practice your data tidying skills, specifically reshaping data with pivot functions and bringing two data frames together with join functions.

Make sure to upload your completed lab to Gradescope **by the end of your lab session** and commit and push your final version to GitHub.

## Getting started

By now you should be familiar with how to get started with a lab assignment by cloning the GitHub repo for the assignment.

<details>
<summary>Click to expand if you need a refresher on how to get started with a lab assignment.</summary>

-   Go to <https://cmgr.oit.duke.edu/containers> and login with your Duke NetID and Password.
-   Click `STA199` under My reservations to log into your container. You should now see the RStudio environment.
-   Go to the course organization at [github.com/sta199-f25](https://github.com/sta199-f25) organization on GitHub.
    Click on the repo with the prefix **lab-3**.
    It contains the starter documents you need to complete the homework.
-   Click on the green **CODE** button, select **Use SSH**.
    Click on the clipboard icon to copy the repo URL.
-   In RStudio, go to *File* ➛ *New Project* ➛*Version Control* ➛ *Git*.
-   Copy and paste the URL of your assignment repo into the dialog box *Repository URL*. Again, please make sure to have *SSH* highlighted under *Clone* when you copy the address.
-   Click *Create Project*, and the files from your GitHub repo will be displayed in the *Files* pane in RStudio.
</details>

Open the *lab-3.qmd* template Quarto file and update the `authors` field to add your name first (first and last) and then your teammates' names (first and last).
Render the document.
Examine the rendered document and make sure your and your teammates' names are updated in the document.
Commit and push your changes with a meaningful commit message and push to GitHub.

<details>
<summary>Click to expand if you need a refresher on assignment guidelines.</summary>
{{< include _guidelines.qmd >}}
</details>

# Packages

In this lab we will work with the **tidyverse** package.

```{r}
#| eval: true
#| message: false
library(tidyverse)
```

# Questions

## Question 1

**Pivot longer and wider.**

a.  For this part, you will work with the following dataset called `scores`.

```{r}
#| eval: true
# fmt: skip
scores <- tribble(
  ~student_id, ~math, ~english,
  "S1",        90,    92,
  "S2",        85,    80,
  "S3",        88,    85,
  "S4",        95,    74
)

scores
```

::: callout-note
The `tribble()` function is helpful for creating small data frames (`tibble`s) with an easier to read row-by-row layout.
:::

It has three variables (`student_id`, `math`, and `english`) and four rows (one for each student).

Before writing any code, answer the following questions:

- Suppose you want to reshape the data frame so that there is one row per student per subject.
  What function would you use to do this?

- If you reshaped the data to have one row per student per subject, 
  - how many rows would the resulting data frame have?
  - how many columns would the resulting data frame have and what would the column names be?

Then, write the code to reshape the data frame as described above. 

::: render-commit-push
Render, commit, and push your changes to GitHub with a succinct and informative commit message.

Make sure to commit and push all changed files so that your Git pane is empty afterward.
:::

b.  For this part, you will work with the following dataset called `patients`.

```{r}
#| eval: true
# fmt: skip
patients <- tribble(
  ~patient_id, ~measurement_time_, ~systolic_bp,
  "P1",        "Morning",          120,
  "P1",        "Noon",             115,
  "P1",        "Evening",          123,
  "P2",        "Morning",          118,
  "P2",        "Evening",          121
)

patients
```

It has three variables (`patient_id`, `measurement_time_`, and `systolic_bp` -- short for systolic blood pressure) and five rows (one per patient per measurement time).

Before writing any code, answer the following questions:

- Suppose you want to reshape the data frame so that there is one row per patient and measurements at different times of the day are recorded in different columns.
  What function would you use to do this?

- If you reshaped the data to have one row per patient, 
  - how many rows would the resulting data frame have?
  - how many columns would the resulting data frame have and what would the column names be?

Then, write the code to reshape the data frame as described above. What does the `NA` value mean in the resulting data frame?

::: render-commit-push
Render, commit, and push your changes to GitHub with a succinct and informative commit message.

Make sure to commit and push all changed files so that your Git pane is empty afterward.
:::

## Question 2

For this question, you will work with the following dataset called `grad_years` as well as the student scores dataset from Question 1a (`scores`), and join them with various join functions.

```{r}
#| eval: true
# fmt: skip
grad_years <- tribble(
  ~id,  ~graduation_year,
  "S1", 2023,
  "S3", 2023,
  "S5", 2025,
  "S6", 2024
)

grad_years
```

a.  Your friend writes the following code to join the `scores` and `grad_years` data frames and gets an error message:

```{r}
#| eval: true
#| error: true
scores |>
  left_join(grad_years)
```

What does the error message mean and why does it occur? How would you fix the code?

b.  How many rows and columns does the resulting data frame from part(a) have? Explain why.

c.  Don't write any code yet: Suppose you join the two data frames, `scores` and `grad_years` with a `right_join()`, in that order. How many rows and columns would the resulting data frame have? Then, write the code to perform the join. If your guess wasn't correct, discuss with your teammates before proceeding.

d.  Start with the code this time. Join the two data frames, `scores` and `grad_years` with an `inner_join()`, in that order. How many rows and columns does the resulting data frame have? Explain why.

e.  Don't write any code yet: Suppose you join the two data frames, `grad_years` and `scores` with an `inner_join()` again, but in the reverse order (`grad_years` first, then `scores`). Would you expect the resulting data frame to have the same number of rows as the previous part or a different number of rows? Explain your reasoning. Then, write the code to perform the join. If your guess wasn't correct, discuss with your teammates before proceeding.

f.  Don't write any code yet: Suppose you join the two data frames, `scores` and `grad_years` with an `anti_join()`. Which observation(s) would be in the resulting data frame? Then, write the code to perform the join. If your guess wasn't correct, discuss with your teammates before proceeding.

g.  Don't write any code yet: Suppose you join the two data frames, `grad_years` and `scores` with an `anti_join()` again, but in the reverse order (`grad_years` first, then `scores`). Which observation(s) would be in the resulting data frame? Then, write the code to perform the join. If your guess wasn't correct, discuss with your teammates before proceeding.

h.  Start with the code this time. Join the two data frames, `scores` and `grad_years` with a `full_join()`, in that order. How many rows and columns does the resulting data frame have? Explain why.

i.  Your ultimate goal is to construct a dataset where you have all students who are in the `scores` data frame and their subject scores and graduation years. In order to accomplish this, you will need to look up some students' graduation years in an alternate resource, since they're not all in the `grad_years` data frame. Which join function would you use to find out whose graduation years you need to look up in an alternate resource? Write the code to perform the join to confirm your answer.

::: render-commit-push
Render, commit, and push your changes to GitHub with a succinct and informative commit message.

Make sure to commit and push all changed files so that your Git pane is empty afterward.
:::

# Wrap-up

::: callout-warning
Before you wrap up the assignment, make sure that you render, commit, and push one final time so that the final versions of both your `.qmd` file and the rendered PDF are pushed to GitHub and your Git pane is empty.
We will be checking these to make sure you have been practicing how to commit and push changes.
:::

## Submission

By now you should also be familiar with how to submit your assignment in Gradescope.

<details>
<summary>Click to expand if you need a refresher on how to get started with a lab assignment.</summary>

{{< include _submission.qmd >}}

</details>

## Grading and feedback

-   This lab is worth 30 points:
    -   10 points for being in lab and turning in *something* -- no partial credit for this part.
    -   20 points for:
        -   answering the questions correctly -- there is partial credit for this part.
        -   following the workflow -- there is partial credit for this part.
-   The workflow points are for:
    -   committing at least three times as you work through your lab,
    -   having your final version of `.qmd` and `.pdf` files in your GitHub repository, and
    -   overall organization.
-   You'll receive feedback on your lab on Gradescope within a week.

Good luck, and have fun with it!
